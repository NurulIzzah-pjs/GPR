<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Glow Paint Run</title>
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicons -->
    <link href="../assets/img/favicon.png" rel="icon" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />

    <!-- Vendor CSS Files -->
    <link
      href="../assets/vendor/bootstrap/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="../assets/vendor/bootstrap-icons/bootstrap-icons.css"
      rel="stylesheet"
    />
    <script href="../assets/vendor/aos/aos.css" rel="stylesheet"></script>

    <!-- Bootstrap 4 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- jQuery (required for Bootstrap 4 JS) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Bootstrap 4 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Main CSS File -->
    <link href="../assets/css/bypackage.css" rel="stylesheet" />
</head>

<body class="index-page">

    <header id="header" class="header d-flex align-items-center px-3 sticky-top">
        <div class="container-fluid position-relative d-flex align-items-center justify-content-between">
          <a href="../index.html" class="logo d-flex align-items-center">
            <h1 class="sitename">3KPP USM</h1>
          </a>
          <nav id="navmenu" class="navmenu">
            <ul>
              <li><a href="admin_dashboard.html" >Dashboard</a></li>
              <li><a href="event_details.html">Manage Event</a></li>
              <li><a href="manage_participant.html" class="active">Participant Details</a></li>
                <li><a href="../index.html">Logout</a></li>

              <!-- <li class="dropdown">
                <a href="javascript:void(0)" class="dropdown-toggle" id="participantDetailsDropdown" data-bs-toggle="dropdown" aria-expanded="false">Participant Details</a>
                <ul class="dropdown-menu" aria-labelledby="participantDetailsDropdown">
                  <li><a class="dropdown-item" href="manage_participant.html#participant">List by Package</a></li>
                  <li><a class="dropdown-item" href="manage_participant.html#Attendance">Participant attendance</a></li>
                </ul>
              </li> -->
            </ul>
            <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
          </nav>
        </div>
      </header>

  <main class="main">
    <!-- participant Section -->
    <section id="participant" class="participant section transparent-background">
        <div class="container text-center" data-aos="fade-up" data-aos-delay="100">
            <div class="row justify-content-center">
              <!-- <div class="col-lg-8"> -->
                <h2>Manage Participants</h2>


<!-- GLOWRIOUS PRO PARTICIPANT LIST -->
<div class="event-card">
  <h3>GLOW-RIOUS <b>PRO</b></h3>
  <div class="container">
      <div class="table-wrapper">
          <!-- Student Table -->
          <div class="table-title">
              <div class="row">
                  <div class="col-sm-6">
                      <h4><b>STUDENT</b> list</h4>
                  </div>
                  <div class="col-sm-6">
                      <a href="#addParticipantModal" class="btn btn-success" data-toggle="modal"><i class="material-icons">&#xE147;</i> <span>Add New Student</span></a>
                      <a href="#deleteParticipantModal" class="btn btn-danger" data-toggle="modal"><i class="material-icons">&#xE15C;</i> <span>Delete</span></a>    
                  </div>
              </div>
          </div>
          <table class="table table-striped table-hover">
              <thead>
                  <tr>
                      <th>
                          <span class="custom-checkbox">
                              <input type="checkbox" id="selectAllStudents">
                              <label for="selectAllStudents"></label>
                          </span>
                      </th>
                      <th>Name</th>
                      <th>Matrics No</th>
                      <th>Phone</th>
                      <th>Attendance</th>
                      <th>Actions</th>
                  </tr>
              </thead>
              <tbody id="studentTable">
                  <!-- Data will be injected here by JavaScript -->
              </tbody>
          </table>
      </div>
          <!-- Outsider Table -->
          <div class="table-wrapper">
          <div class="table-title">
              <div class="row">
                  <div class="col-sm-6">
                      <h4><b>OUTSIDER</b> list</h4>
                  </div>
                  <div class="col-sm-6">
                      <a href="#addParticipantModal" class="btn btn-success" data-toggle="modal"><i class="material-icons">&#xE147;</i> <span>Add New Outsider</span></a>
                      <a href="#deleteParticipantModal" class="btn btn-danger" data-toggle="modal"><i class="material-icons">&#xE15C;</i> <span>Delete</span></a>    
                  </div>
              </div>
          </div>
          <table class="table table-striped table-hover">
              <thead>
                  <tr>
                      <th>
                          <span class="custom-checkbox">
                              <input type="checkbox" id="selectAllOutsiders">
                              <label for="selectAllOutsiders"></label>
                          </span>
                      </th>
                      <th>Name</th>
                      <th>IC No</th>
                      <th>Phone</th>
                      <th>Attendance</th>
                      <th>Actions</th>
                  </tr>
              </thead>
              <tbody id="outsiderTable">
                  <!-- Data will be injected here by JavaScript -->
              </tbody>
          </table>

          <div class="clearfix">
              <div class="hint-text">Showing <b>5</b> out of <b>25</b> entries</div>
              <ul class="pagination">
                  <li class="page-item disabled"><a href="#">Previous</a></li>
                  <li class="page-item"><a href="#" class="page-link">1</a></li>
                  <li class="page-item"><a href="#" class="page-link">2</a></li>
                  <li class="page-item active"><a href="#" class="page-link">3</a></li>
                  <li class="page-item"><a href="#" class="page-link">4</a></li>
                  <li class="page-item"><a href="#" class="page-link">5</a></li>
                  <li class="page-item"><a href="#" class="page-link">Next</a></li>
              </ul>
          </div>
      </div>
  </div>
</div>

<!-- GLOWRIOUS LITE PARTICIPANT LIST -->
<div class="event-card">
  <h3>GLOW-RIOUS <b>Lite</b></h3>
  <div class="container">
      <div class="table-wrapper">
          <!-- Student Table -->
          <div class="table-title">
              <div class="row">
                  <div class="col-sm-6">
                      <h4><b>STUDENT</b> list</h4>
                  </div>
                  <div class="col-sm-6">
                      <a href="#addParticipantModal" class="btn btn-success" data-toggle="modal"><i class="material-icons">&#xE147;</i> <span>Add New Student</span></a>
                      <a href="#deleteParticipantModal" class="btn btn-danger" data-toggle="modal"><i class="material-icons">&#xE15C;</i> <span>Delete</span></a>    
                  </div>
              </div>
          </div>
          <table class="table table-striped table-hover">
              <thead>
                  <tr>
                      <th>
                          <span class="custom-checkbox">
                              <input type="checkbox" id="selectAllStudents">
                              <label for="selectAllStudents"></label>
                          </span>
                      </th>
                      <th>Name</th>
                      <th>Matrics No</th>
                      <th>Phone</th>
                      <th>Attendance</th>
                      <th>Actions</th>
                  </tr>
              </thead>
              <tbody id="studentTable">
                  <!-- Data will be injected here by JavaScript -->
              </tbody>
          </table>
      </div>
  </div>
</div>

<!-- GLOWRIOUS STARTER PARTICIPANT LIST -->
<div class="event-card">
  <h3>GLOW-RIOUS <b>Starter</b></h3>
  <div class="container">
      <div class="table-wrapper">
          <!-- Student Table -->
          <div class="table-title">
              <div class="row">
                  <div class="col-sm-6">
                      <h4><b>STUDENT</b> list</h4>
                  </div>
                  <div class="col-sm-6">
                      <a href="#addParticipantModal" class="btn btn-success" data-toggle="modal"><i class="material-icons">&#xE147;</i> <span>Add New Student</span></a>
                      <a href="#deleteParticipantModal" class="btn btn-danger" data-toggle="modal"><i class="material-icons">&#xE15C;</i> <span>Delete</span></a>    
                  </div>
              </div>
          </div>
          <table class="table table-striped table-hover">
              <thead>
                  <tr>
                      <th>
                          <span class="custom-checkbox">
                              <input type="checkbox" id="selectAllStudents">
                              <label for="selectAllStudents"></label>
                          </span>
                      </th>
                      <th>Name</th>
                      <th>Matrics No</th>
                      <th>Phone</th>
                      <th>Attendance</th>
                      <th>Actions</th>
                  </tr>
              </thead>
              <tbody id="studentTable">
                  <!-- Data will be injected here by JavaScript -->
              </tbody>
          </table>
      </div>
  </div>
</div>

<!-- JavaScript to fetch and display participant data -->
<script>
   document.addEventListener("DOMContentLoaded", function () {
    fetch('../api/fetch_participants.php')
        .then(response => response.json())
        .then(data => {
            const studentTable = document.getElementById('studentTable');
            const outsiderTable = document.getElementById('outsiderTable');

            // Clear existing table data
            studentTable.innerHTML = '';
            outsiderTable.innerHTML = '';

            // Loop through each package
            Object.values(data).forEach(packageData => {
                // Process students
                packageData.Students.forEach(student => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><span class='custom-checkbox'><input type='checkbox' id='checkbox${student.ParticipantID}' name='options[]' value='${student.ParticipantID}'><label for='checkbox${student.ParticipantID}'></label></span></td>
                        <td>${student.Name}</td>
                        <td>${student.MatricNum}</td>
                        <td>${student.PhoneNum}</td>
                        <td>${student.AttendanceStatus}</td>
                        <td><a href='#editParticipantModal' class='edit' data-toggle='modal'><i class='material-icons' data-toggle='tooltip' title='Edit'>&#xE254;</i></a>
                            <a href='#deleteParticipantModal' class='delete' data-toggle='modal'><i class='material-icons' data-toggle='tooltip' title='Delete'>&#xE872;</i></a></td>
                    `;
                    studentTable.appendChild(row);
                });

                // Process outsiders
                packageData.Outsiders.forEach(outsider => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><span class='custom-checkbox'><input type='checkbox' id='checkbox${outsider.ParticipantID}' name='options[]' value='${outsider.ParticipantID}'><label for='checkbox${outsider.ParticipantID}'></label></span></td>
                        <td>${outsider.Name}</td>
                        <td>${outsider.IdentificationNum}</td>
                        <td>${outsider.PhoneNum}</td>
                        <td>${outsider.AttendanceStatus}</td>
                        <td><a href='#editParticipantModal' class='edit' data-toggle='modal'><i class='material-icons' data-toggle='tooltip' title='Edit'>&#xE254;</i></a>
                            <a href='#deleteParticipantModal' class='delete' data-toggle='modal'><i class='material-icons' data-toggle='tooltip' title='Delete'>&#xE872;</i></a></td>
                    `;
                    outsiderTable.appendChild(row);
                });
            });
        })
        .catch(error => console.error('Error fetching participant data:', error));
});

</script>

                    </div>

        
    </div>
    </div>
</div>
    </section>
    <!-- END participant Section -->
    </main>

    <!-- Add Participant Modal -->
<div
id="addParticipantModal"
class="modal fade"
tabindex="-1"
role="dialog"
aria-labelledby="addParticipantModalLabel"
aria-hidden="true"
>
<div class="modal-dialog" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="addParticipantModalLabel">
        Edit Participant Details
      </h5>
      <button
        type="button"
        class="close"
        data-dismiss="modal"
        aria-label="Close"
      >
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <form>
        <div class="form-group">
          <label for="participantName">Name</label>
          <input
            type="text"
            class="form-control"
            id="participantName"
            placeholder="Enter participant's name"
          />
        </div>
        <div class="form-group">
          <label for="participantEmail">Email</label>
          <input
            type="email"
            class="form-control"
            id="participantEmail"
            placeholder="Enter participant's email"
          />
        </div>
        <div class="form-group">
          <label for="participantPhone">Phone Number</label>
          <input
            type="text"
            class="form-control"
            id="participantPhone"
            placeholder="Enter participant's phone number"
          />
        </div>
        <div class="form-group">
          <label for="participantStatus">Attendance Status</label>
          <select class="form-control" id="participantStatus">
            <option value="Registered">Yes</option>
            <option value="Canceled">No</option>
          </select>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-secondary"
        data-dismiss="modal"
      >
        Close
      </button>
      <button type="button" class="btn btn-primary" id="saveParticipantBtn">
        Save Changes
      </button>
    </div>
  </div>
</div>
</div>

<!-- Edit Participant Modal -->
<div
  id="editParticipantModal"
  class="modal fade"
  tabindex="-1"
  role="dialog"
  aria-labelledby="editParticipantModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editParticipantModalLabel">
          Edit Participant Details
        </h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="participantName">Name</label>
            <input
              type="text"
              class="form-control"
              id="participantName"
              placeholder="Enter participant's name"
            />
          </div>
          <div class="form-group">
            <label for="participantEmail">Email</label>
            <input
              type="email"
              class="form-control"
              id="participantEmail"
              placeholder="Enter participant's email"
            />
          </div>
          <div class="form-group">
            <label for="participantPhone">Phone Number</label>
            <input
              type="text"
              class="form-control"
              id="participantPhone"
              placeholder="Enter participant's phone number"
            />
          </div>
          <div class="form-group">
            <label for="participantStatus">Attendance Status</label>
            <select class="form-control" id="participantStatus">
              <option value="Registered">Yes</option>
              <option value="Canceled">No</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-dismiss="modal"
        >
          Close
        </button>
        <button type="button" class="btn btn-primary" id="saveParticipantBtn">
          Save Changes
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Delete Participant Modal -->
<div
  id="deleteParticipantModal"
  class="modal fade"
  tabindex="-1"
  role="dialog"
  aria-labelledby="deleteParticipantModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteParticipantModalLabel">
          Delete Participant
        </h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this participant?</p>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-dismiss="modal"
        >
          Cancel
        </button>
        <button type="button" class="btn btn-danger" id="deleteParticipantBtn">
          Delete
        </button>
      </div>
    </div>
  </div>
</div>
<footer id="footer" class="footer transparent-background">
    <div class="container">
      <div class="copyright text-center ">
        <p>© <span>Copyright</span> <strong class="px-1 sitename">ComingSoon</strong> <span>All Rights Reserved</span></p>
      </div>
      <div class="social-links d-flex justify-content-center">
        <a href="https://m.facebook.com/profile.php?id=100085816266970"><i class="bi bi-facebook"></i></a>
        <a href="https://www.instagram.com/3kpp_usm/?hl=en"><i class="bi bi-instagram"></i></a>
        <a href="https://www.tiktok.com/@3kpp_usm?_t=8rUfpqcwQLv&_r=1"><i class="bi bi-tiktok"></i></a>
      </div>
    </div>
  </footer>
<!-- JavaScript -->
<script>
  $(document).ready(function () {
    // Handle Edit Participant button click
    $(document).on("click", "a.edit-participant", function () {
      const participantId = $(this).data("id");
      const participantName = $(this).data("name");
      const participantEmail = $(this).data("email");
      const participantPhone = $(this).data("phone");
      const participantStatus = $(this).data("status");

      // Populate modal fields
      $("#participantName").val(participantName);
      $("#participantEmail").val(participantEmail);
      $("#participantPhone").val(participantPhone);
      $("#participantStatus").val(participantStatus);

      // Store participant ID in the save button for later use
      $("#saveParticipantBtn").data("id", participantId);
    });

    // Save changes to participant details
    $("#saveParticipantBtn").click(function () {
      const participantId = $(this).data("id");
      const updatedName = $("#participantName").val();
      const updatedEmail = $("#participantEmail").val();
      const updatedPhone = $("#participantPhone").val();
      const updatedStatus = $("#participantStatus").val();

      // Update the participant row
      const row = $(`tr[data-id="${participantId}"]`);
      row.find(".participant-name").text(updatedName);
      row.find(".participant-email").text(updatedEmail);
      row.find(".participant-phone").text(updatedPhone);
      row.find(".participant-status").text(updatedStatus);

      // Save updated data to localStorage
      localStorage.setItem(`participant_${participantId}`, JSON.stringify({
        name: updatedName,
        email: updatedEmail,
        phone: updatedPhone,
        status: updatedStatus,
      }));

      // Close the modal
      $("#editParticipantModal").modal("hide");
    });

    // Handle Delete Participant button click
    $(document).on("click", "a.delete-participant", function () {
      const participantId = $(this).data("id");
      $("#deleteParticipantBtn").data("id", participantId);
    });

    // Confirm participant deletion
    $("#deleteParticipantBtn").click(function () {
      const participantId = $(this).data("id");
      $(`tr[data-id="${participantId}"]`).remove();
      localStorage.removeItem(`participant_${participantId}`);
      $("#deleteParticipantModal").modal("hide");
    });

    // Load participants from localStorage on page load
    $("tr[data-id]").each(function () {
      const participantId = $(this).data("id");
      const savedData = localStorage.getItem(`participant_${participantId}`);
      if (savedData) {
        const participant = JSON.parse(savedData);
        $(this).find(".participant-name").text(participant.name);
        $(this).find(".participant-email").text(participant.email);
        $(this).find(".participant-phone").text(participant.phone);
        $(this).find(".participant-status").text(participant.status);
      }
    });
  });

  document.addEventListener("DOMContentLoaded", function () {
    fetch('../api/fetch_participants.php')
        .then(response => response.json())
        .then(data => {
            // Define table elements for each package
            const tables = {
                1: document.querySelector('.event-card:nth-of-type(3) #studentTable'), // GLOW-RIOUS STARTER
                2: {
                    students: document.querySelector('.event-card:nth-of-type(1) #studentTable'), // GLOW-RIOUS PRO - Students
                    outsiders: document.querySelector('.event-card:nth-of-type(1) #outsiderTable'), // GLOW-RIOUS PRO - Outsiders
                },
                3: document.querySelector('.event-card:nth-of-type(2) #studentTable'), // GLOW-RIOUS LITE
            };

            // Clear existing table data
            Object.values(tables).forEach(table => {
                if (typeof table === 'object' && table.students && table.outsiders) {
                    table.students.innerHTML = '';
                    table.outsiders.innerHTML = '';
                } else if (table) {
                    table.innerHTML = '';
                }
            });

            // Loop through each package
            Object.entries(data).forEach(([packageID, packageData]) => {
                const pkgID = parseInt(packageID);

                // Handle Students
                packageData.Students.forEach(student => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><span class='custom-checkbox'><input type='checkbox' id='checkbox${student.ParticipantID}' name='options[]' value='${student.ParticipantID}'><label for='checkbox${student.ParticipantID}'></label></span></td>
                        <td>${student.Name}</td>
                        <td>${student.MatricNum}</td>
                        <td>${student.PhoneNum}</td>
                        <td>${student.AttendanceStatus}</td>
                        <td><a href='#editParticipantModal' class='edit' data-toggle='modal'><i class='material-icons' data-toggle='tooltip' title='Edit'>&#xE254;</i></a>
                            <a href='#deleteParticipantModal' class='delete' data-toggle='modal'><i class='material-icons' data-toggle='tooltip' title='Delete'>&#xE872;</i></a></td>
                    `;

                    if (pkgID === 2) {
                        tables[2].students.appendChild(row); // GLOW-RIOUS PRO Students
                    } else if (tables[pkgID]) {
                        tables[pkgID].appendChild(row); // Other packages
                    }
                });

                // Handle Outsiders (only for GLOW-RIOUS PRO)
                if (pkgID === 2 && packageData.Outsiders) {
                    packageData.Outsiders.forEach(outsider => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td><span class='custom-checkbox'><input type='checkbox' id='checkbox${outsider.ParticipantID}' name='options[]' value='${outsider.ParticipantID}'><label for='checkbox${outsider.ParticipantID}'></label></span></td>
                            <td>${outsider.Name}</td>
                            <td>${outsider.IdentificationNum}</td>
                            <td>${outsider.PhoneNum}</td>
                            <td>${outsider.AttendanceStatus}</td>
                            <td><a href='#editParticipantModal' class='edit' data-toggle='modal'><i class='material-icons' data-toggle='tooltip' title='Edit'>&#xE254;</i></a>
                                <a href='#deleteParticipantModal' class='delete' data-toggle='modal'><i class='material-icons' data-toggle='tooltip' title='Delete'>&#xE872;</i></a></td>
                        `;
                        tables[2].outsiders.appendChild(row); // GLOW-RIOUS PRO Outsiders
                    });
                }
            });
        })
        .catch(error => console.error('Error fetching participant data:', error));
});

</script>

</body>
</html>